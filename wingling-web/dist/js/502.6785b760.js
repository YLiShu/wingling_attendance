"use strict";(self["webpackChunkwingling_web"]=self["webpackChunkwingling_web"]||[]).push([[502],{5502:function(t,e,s){s.r(e),s.d(e,{default:function(){return g}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"clockManagement"},[e("div",{staticClass:"title"},[t._v("考勤管理")]),e("div",{staticClass:"clockManagement_header"},[t._m(0),e("div",{staticClass:"header_right",on:{click:t.exportFile}},[e("img",{attrs:{src:"/assets/images/clockManagement/export.png",alt:"export"}}),e("div",{staticClass:"header_right_action"},[t._v("导出报表")])])]),t.makeUpClockList.length?e("div",{staticClass:"main"},t._l(t.makeUpClockList,(function(s){return e("SwipeToDoItem",{key:s._id,attrs:{item:s},on:{reject:t.rejectItem,passed:t.passedItem},scopedSlots:t._u([{key:"content",fn:function(){return[e("div",{staticClass:"application_item"},[e("div",{staticClass:"item_title"},[e("div",{staticClass:"title_left"},[t._v(" "+t._s(s.userInfo.realname)+"提交的补卡 ")]),e("div",{staticClass:"title_right"},[t._v(t._s(s.date))])]),e("div",{staticClass:"item_main"},[e("div",{staticClass:"main_left"},[e("div",{staticClass:"application_total"},[t._v(" 补卡时长："+t._s(s.duration)+"分钟 ")]),e("div",{staticClass:"application_reason"},[t._v(" 补卡理由："+t._s(s.reason)+" ")])]),e("div",{staticClass:"main_right"},[e("div",{staticClass:"application_time"},[t._v(" 起始时间："+t._s(s.startTime)+" ")]),e("div",{staticClass:"application_time"},[t._v("结束时间："+t._s(s.endTime))])])]),e("div",{staticClass:"item_footer"},[e("div",{staticClass:"footer_left"},[e("img",{staticClass:"avatar",attrs:{src:s.userInfo.avatar,alt:"avatar"}}),e("div",{staticClass:"application_person"},[t._v(" 由"+t._s(s.userInfo.realname)+"提交 ")])])])])]},proxy:!0}],null,!0)})})),1):e("div",{staticClass:"main empty"},[e("wingling-empty",{attrs:{"image-size":200,description:"暂无待处理补卡申请"}})],1),t.showRejectReasonModal?e("div",{staticClass:"modal"},[e("div",{staticClass:"modal-content"},[e("span",{staticClass:"close",on:{click:t.closeRejectReasonModal}},[t._v("×")]),e("form",{on:{submit:function(e){return e.preventDefault(),t.onSubmit.apply(null,arguments)}}},[e("InputBox",{attrs:{imgSrc:"/assets/images/clockManagement/reject.png",placeholder:"拒绝原因",type:"text",minlength:5,tips:"请正确输入拒绝原因"},model:{value:t.rejectReason,callback:function(e){t.rejectReason=e},expression:"rejectReason"}}),e("div",{staticClass:"form_footer"},[e("button",{staticClass:"btn cancel",on:{click:t.cancel}},[t._v("取消")]),e("button",{staticClass:"btn",attrs:{type:"submit"}},[t._v("确定")])])],1)])]):t._e()])},a=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"header_left"},[e("img",{attrs:{src:"/assets/images/logo.png",alt:"logo-img"}}),e("div",{staticClass:"header_title_company"},[t._v("翼灵物联网工作室")])])}],n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"swipe-to-reject-item",class:{swiping:t.isSwiping},on:{touchstart:t.handleTouchStart,touchmove:t.handleTouchMove,touchend:t.handleTouchEnd}},[e("div",{staticClass:"item-content"},[t._t("content")],2),t.isPC?e("div",{staticClass:"pc-reject",on:{click:function(e){return e.stopPropagation(),t.handleShowOptions.apply(null,arguments)}}},[e("div",{staticClass:"options"},[e("i",{staticClass:"el-icon-more-outline"}),t.showOptions?e("div",{staticClass:"options-popup"},[e("div",{staticClass:"option passed",on:{click:t.confirmPassed}},[t._v("通过")]),e("div",{staticClass:"option reject"},[e("wingling-popconfirm",{attrs:{"confirm-button-type":"danger","cancel-button-type":"info","confirm-button-text":"确认","cancel-button-text":"取消",icon:"el-icon-info","icon-color":"red",title:`确认拒绝${t.item.userInfo.realname}的补卡申请吗？`},on:{confirm:t.confirmReject,cancel:t.cancelReject}},[e("span",{attrs:{slot:"reference"},on:{click:function(t){t.stopPropagation()}},slot:"reference"},[t._v("拒绝")])])],1)]):t._e()])]):e("div",{staticClass:"reject_passed-button",class:{active:t.isButtonActive}},[e("div",{staticClass:"rejectBtn",on:{click:t.confirmReject}},[t._v("拒绝")]),e("div",{staticClass:"passedBtn",on:{click:t.confirmPassed}},[t._v("通过")])])])},o=[],c={props:{item:{type:Object,required:!0}},data(){return{isSwiping:!1,startX:0,currentX:0,deltaX:0,isButtonActive:!1,isPC:window.innerWidth>820,showOptions:!1}},methods:{handleResize(){this.isPC=window.innerWidth>820},handleTouchStart(t){this.startX=t.touches[0].clientX,this.currentX=this.startX,this.deltaX=0,this.isSwiping=!1,this.isButtonActive=!1},handleTouchMove(t){const e=t.touches[0];this.currentX=e.clientX,this.deltaX=this.currentX-this.startX,this.isSwiping=Math.abs(this.deltaX)>10,this.$root.$emit("hideRejectButtons",this.item),this.isButtonActive=this.deltaX<-80},handleTouchEnd(){this.isSwiping&&(this.isSwiping=!1)},confirmReject(){this.$emit("reject",this.item),this.isButtonActive=!1},handleShowOptions(){this.showOptions=!0},cancelReject(){this.showOptions=!1},confirmPassed(){this.$emit("passed",this.item),this.isButtonActive=!1}},created(){window.addEventListener("resize",this.handleResize),this.$root.$on("hideRejectButtons",(t=>{this.item!==t&&(this.isButtonActive=!1)}))},beforeDestroy(){window.removeEventListener("resize",this.handleResize),this.$root.$off("hideRejectButtons")}},l=c,r=s(1001),d=(0,r.Z)(l,n,o,!1,null,"788be7b2",null),h=d.exports,p=s(8326),m=s(471);const u=()=>m.Z.get("/api/makeupClock/get"),v=(t,e)=>m.Z.put(`/api/makeupClock/update/${t}`,e),_=async()=>{try{const t=await m.Z.get("/api/clock/export",{responseType:"blob"}),e=t,s=document.createElement("a");s.href=URL.createObjectURL(e),s.download="weekly_report.xlsx",s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(s.href)}catch(t){console.error("发生错误:",t)}};var C=s(6944),f={data(){return{makeUpClockList:[],rejectReason:"",showRejectReasonModal:!1,itemToReject:null,itemToPassed:null}},components:{SwipeToDoItem:h,InputBox:p.Z},methods:{rejectItem(t){this.itemToReject=this.makeUpClockList.find((e=>e._id===t._id)),this.itemToReject&&(this.showRejectReasonModal=!0)},async passedItem(t){if(this.itemToPassed=this.makeUpClockList.find((e=>e._id===t._id)),this.itemToPassed){const t={status:"pass"};try{await v(this.itemToPassed._id,t),(0,C.Z)("success","处理成功")}catch(e){console.warn(e)}this.initMakeUpClockList()}},async initMakeUpClockList(){const{data:t}=await u();t.forEach((t=>{t.userInfo.avatar=`http://127.0.0.1:3000${t.userInfo.avatar}`})),this.makeUpClockList=t},closeRejectReasonModal(){this.showRejectReasonModal=!1},async onSubmit(){const t={rejectReason:this.rejectReason,status:"reject"};try{await v(this.itemToReject._id,t),(0,C.Z)("success","处理成功")}catch(e){console.warn(e)}this.rejectReason="",this.showRejectReasonModal=!1,this.initMakeUpClockList()},cancel(){this.rejectReason="",this.showRejectReasonModal=!1},exportFile(){_()}},created(){this.initMakeUpClockList()}},k=f,w=(0,r.Z)(k,i,a,!1,null,"9d0ab86c",null),g=w.exports}}]);
//# sourceMappingURL=502.6785b760.js.map